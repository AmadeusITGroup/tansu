<!DOCTYPE html><html class="default" lang="en"><head><meta charset="utf-8"/><meta http-equiv="x-ua-compatible" content="IE=edge"/><title>@amadeus-it-group/tansu</title><meta name="description" content="Documentation for @amadeus-it-group/tansu"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="stylesheet" href="assets/style.css"/><link rel="stylesheet" href="assets/highlight.css"/><script defer src="assets/main.js"></script><script async src="assets/icons.js" id="tsd-icons-script"></script><script async src="assets/search.js" id="tsd-search-script"></script><script async src="assets/navigation.js" id="tsd-nav-script"></script></head><body><script>document.documentElement.dataset.theme = localStorage.getItem("tsd-theme") || "os";document.body.style.display="none";setTimeout(() => app?app.showPage():document.body.style.removeProperty("display"),500)</script><header class="tsd-page-toolbar"><div class="tsd-toolbar-contents container"><div class="table-cell" id="tsd-search" data-base="."><div class="field"><label for="tsd-search-field" class="tsd-widget tsd-toolbar-icon search no-caption"><svg width="16" height="16" viewBox="0 0 16 16" fill="none"><use href="assets/icons.svg#icon-search"></use></svg></label><input type="text" id="tsd-search-field" aria-label="Search"/></div><div class="field"><div id="tsd-toolbar-links"></div></div><ul class="results"><li class="state loading">Preparing search index...</li><li class="state failure">The search index is not available</li></ul><a href="index.html" class="title">@amadeus-it-group/tansu</a></div><div class="table-cell" id="tsd-widgets"><a href="#" class="tsd-widget tsd-toolbar-icon menu no-caption" data-toggle="menu" aria-label="Menu"><svg width="16" height="16" viewBox="0 0 16 16" fill="none"><use href="assets/icons.svg#icon-menu"></use></svg></a></div></div></header><div class="container container-main"><div class="col-content"><div class="tsd-page-title"><h1>@amadeus-it-group/tansu</h1></div><div class="tsd-panel tsd-typography"><a id="md:tansu" class="tsd-anchor"></a><h1 class="tsd-anchor-link">Tansu<a href="#md:tansu" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h1><p><a href="https://www.npmjs.com/package/@amadeus-it-group/tansu" target="_blank" class="external"><img src="https://img.shields.io/npm/v/@amadeus-it-group/tansu" alt="npm"></a>
<img src="https://github.com/AmadeusITGroup/tansu/workflows/ci/badge.svg" alt="build">
<a href="https://codecov.io/gh/AmadeusITGroup/tansu" target="_blank" class="external"><img src="https://codecov.io/gh/AmadeusITGroup/tansu/branch/master/graph/badge.svg" alt="codecov"></a></p>
<p>Tansu is a lightweight, push-based framework-agnostic state management library.
It borrows the ideas and APIs originally designed and implemented by <a href="https://github.com/sveltejs/rfcs/blob/master/text/0002-reactive-stores.md" target="_blank" class="external">Svelte stores</a>
and extends them with <code>computed</code> and <code>batch</code>.</p>
<p>Main characteristics:</p>
<ul>
<li>small conceptual surface with expressive and very flexible API (functional and class-based);</li>
<li>can be used to create &quot;local&quot; (module-level or component-level), collaborating stores;</li>
<li>can handle both immutable and mutable data;</li>
<li>results in compact code with the absolute minimum of boilerplate.</li>
</ul>
<p>Implementation wise, it is a tiny (1300 LOC) library without any external dependencies.</p>
<a id="md:installation" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Installation<a href="#md:installation" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h2><p>You can add Tansu to your project by installing the <code>@amadeus-it-group/tansu</code> package using your favorite package manager, ex.:</p>
<ul>
<li><code>yarn add @amadeus-it-group/tansu</code></li>
<li><code>npm install @amadeus-it-group/tansu</code></li>
</ul>
<a id="md:usage" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Usage<a href="#md:usage" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h2><p>Check out the <a href="https://amadeusitgroup.github.io/tansu/" target="_blank" class="external">Tansu API documentation</a>.</p>
<p>The functional part of the API to manage your reactive state can be categorized into three distinct groups:</p>
<ul>
<li>Base store: <code>writable</code></li>
<li>Computed stores: <code>derived</code>, <code>computed</code>, <code>readable</code></li>
<li>Utilities: <code>batch</code>, <code>asReadable</code>, <code>asWritable</code></li>
</ul>
<a id="md:writable" class="tsd-anchor"></a><h3 class="tsd-anchor-link">writable<a href="#md:writable" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h3><p><a href="https://amadeusitgroup.github.io/tansu/functions/writable.html" target="_blank" class="external">api documentation</a></p>
<p><strong>Writable: A Fundamental Building Block</strong></p>
<p>A <code>writable</code> serves as the foundational element of a &quot;store&quot; – a container designed to encapsulate a value, enabling observation and modification of its state. You can change the internal value using the <code>set</code> or <code>update</code> methods.</p>
<p>To receive notifications whenever the value undergoes a change, the <code>subscribe()</code> method, paired with a callback function, can be employed.</p>
<a id="md:basic-usage" class="tsd-anchor"></a><h4 class="tsd-anchor-link">Basic usage<a href="#md:basic-usage" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h4><pre><code class="typescript"><span class="hl-0">import</span><span class="hl-1"> {</span><span class="hl-2">writable</span><span class="hl-1">} </span><span class="hl-0">from</span><span class="hl-1"> </span><span class="hl-3">&quot;@amadeus-it-group/tansu&quot;</span><span class="hl-1">;</span><br/><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-5">value$</span><span class="hl-1"> = </span><span class="hl-6">writable</span><span class="hl-1">(</span><span class="hl-7">0</span><span class="hl-1">);</span><br/><br/><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-5">unsubscribe</span><span class="hl-1"> = </span><span class="hl-2">values$</span><span class="hl-1">.</span><span class="hl-6">subscribe</span><span class="hl-1">((</span><span class="hl-2">value</span><span class="hl-1">) </span><span class="hl-4">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-2">console</span><span class="hl-1">.</span><span class="hl-6">log</span><span class="hl-1">(</span><span class="hl-3">`value = </span><span class="hl-4">${</span><span class="hl-2">value</span><span class="hl-4">}</span><span class="hl-3">`</span><span class="hl-1">);</span><br/><span class="hl-1">});</span><br/><br/><span class="hl-2">value$</span><span class="hl-1">.</span><span class="hl-6">set</span><span class="hl-1">(</span><span class="hl-7">1</span><span class="hl-1">);</span><br/><span class="hl-2">value$</span><span class="hl-1">.</span><span class="hl-6">update</span><span class="hl-1">((</span><span class="hl-2">value</span><span class="hl-1">) </span><span class="hl-4">=&gt;</span><span class="hl-1"> </span><span class="hl-2">value</span><span class="hl-1"> + </span><span class="hl-7">1</span><span class="hl-1">);</span>
</code><button type="button">Copy</button></pre>

<p>output:</p>
<pre><code class="text">  value = 0
  value = 1
  value = 2
</code><button type="button">Copy</button></pre>

<a id="md:setup-and-teardown" class="tsd-anchor"></a><h4 class="tsd-anchor-link">Setup and teardown<a href="#md:setup-and-teardown" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h4><p>The writable's second parameter allows for receiving notifications when at least one subscriber subscribes or when there are no more subscribers.</p>
<pre><code class="typescript"><span class="hl-0">import</span><span class="hl-1"> {</span><span class="hl-2">writable</span><span class="hl-1">} </span><span class="hl-0">from</span><span class="hl-1"> </span><span class="hl-3">&quot;@amadeus-it-group/tansu&quot;</span><span class="hl-1">;</span><br/><br/><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-5">value$</span><span class="hl-1"> = </span><span class="hl-6">writable</span><span class="hl-1">(</span><span class="hl-7">0</span><span class="hl-1">, () </span><span class="hl-4">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-2">console</span><span class="hl-1">.</span><span class="hl-6">log</span><span class="hl-1">(</span><span class="hl-3">&#39;At least one subscriber&#39;</span><span class="hl-1">);</span><br/><br/><span class="hl-1">  </span><span class="hl-0">return</span><span class="hl-1"> () </span><span class="hl-4">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-2">console</span><span class="hl-1">.</span><span class="hl-6">log</span><span class="hl-1">(</span><span class="hl-3">&#39;No more subscriber&#39;</span><span class="hl-1">);</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">});</span><br/><br/><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-5">unsubscribe</span><span class="hl-1"> = </span><span class="hl-2">values$</span><span class="hl-1">.</span><span class="hl-6">subscribe</span><span class="hl-1">((</span><span class="hl-2">value</span><span class="hl-1">) </span><span class="hl-4">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-2">console</span><span class="hl-1">.</span><span class="hl-6">log</span><span class="hl-1">(</span><span class="hl-3">`value = </span><span class="hl-4">${</span><span class="hl-2">value</span><span class="hl-4">}</span><span class="hl-3">`</span><span class="hl-1">);</span><br/><span class="hl-1">});</span><br/><br/><span class="hl-2">value$</span><span class="hl-1">.</span><span class="hl-6">set</span><span class="hl-1">(</span><span class="hl-7">1</span><span class="hl-1">);</span><br/><span class="hl-6">unsubscribe</span><span class="hl-1">();</span>
</code><button type="button">Copy</button></pre>

<p>output:</p>
<pre><code class="text">  At least one subscriber
  value = 0
  value = 1
  No more subscriber
</code><button type="button">Copy</button></pre>

<a id="md:derived" class="tsd-anchor"></a><h3 class="tsd-anchor-link">derived<a href="#md:derived" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h3><p><a href="https://amadeusitgroup.github.io/tansu/functions/derived.html" target="_blank" class="external">api documentation</a></p>
<p>A <code>derived</code> store calculates its value based on one or more other stores provided as parameters.
Since its value is derived from other stores, it is a read-only store and does not have any <code>set</code> or <code>update</code> methods.</p>
<a id="md:single-store" class="tsd-anchor"></a><h4 class="tsd-anchor-link">Single store<a href="#md:single-store" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h4><pre><code class="typescript"><span class="hl-0">import</span><span class="hl-1"> {</span><span class="hl-2">writable</span><span class="hl-1">, </span><span class="hl-2">derived</span><span class="hl-1">} </span><span class="hl-0">from</span><span class="hl-1"> </span><span class="hl-3">&quot;@amadeus-it-group/tansu&quot;</span><span class="hl-1">;</span><br/><br/><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-5">value$</span><span class="hl-1"> = </span><span class="hl-6">writable</span><span class="hl-1">(</span><span class="hl-7">1</span><span class="hl-1">);</span><br/><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-5">double$</span><span class="hl-1"> = </span><span class="hl-6">derived</span><span class="hl-1">(</span><span class="hl-2">value$</span><span class="hl-1">, (</span><span class="hl-2">value</span><span class="hl-1">) </span><span class="hl-4">=&gt;</span><span class="hl-1"> </span><span class="hl-2">value</span><span class="hl-1"> * </span><span class="hl-7">2</span><span class="hl-1">);</span><br/><br/><span class="hl-2">double$</span><span class="hl-1">.</span><span class="hl-6">subscribe</span><span class="hl-1">((</span><span class="hl-2">double</span><span class="hl-1">) </span><span class="hl-4">=&gt;</span><span class="hl-1"> </span><span class="hl-2">console</span><span class="hl-1">.</span><span class="hl-6">log</span><span class="hl-1">(</span><span class="hl-3">&#39;Double value&#39;</span><span class="hl-1">, </span><span class="hl-2">double</span><span class="hl-1">));</span><br/><span class="hl-2">value$</span><span class="hl-1">.</span><span class="hl-6">set</span><span class="hl-1">(</span><span class="hl-7">2</span><span class="hl-1">);</span>
</code><button type="button">Copy</button></pre>

<p>output:</p>
<pre><code class="text">Double value 2
Double value 4
</code><button type="button">Copy</button></pre>

<a id="md:multiple-stores" class="tsd-anchor"></a><h4 class="tsd-anchor-link">Multiple stores<a href="#md:multiple-stores" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h4><pre><code class="typescript"><span class="hl-0">import</span><span class="hl-1"> {</span><span class="hl-2">writable</span><span class="hl-1">, </span><span class="hl-2">derived</span><span class="hl-1">} </span><span class="hl-0">from</span><span class="hl-1"> </span><span class="hl-3">&quot;@amadeus-it-group/tansu&quot;</span><span class="hl-1">;</span><br/><br/><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-5">a$</span><span class="hl-1"> = </span><span class="hl-6">writable</span><span class="hl-1">(</span><span class="hl-7">1</span><span class="hl-1">);</span><br/><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-5">b$</span><span class="hl-1"> = </span><span class="hl-6">writable</span><span class="hl-1">(</span><span class="hl-7">1</span><span class="hl-1">);</span><br/><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-5">sum$</span><span class="hl-1"> = </span><span class="hl-6">derived</span><span class="hl-1">([</span><span class="hl-2">a$</span><span class="hl-1">, </span><span class="hl-2">b$</span><span class="hl-1">], ([</span><span class="hl-2">a</span><span class="hl-1">, </span><span class="hl-2">b</span><span class="hl-1">]) </span><span class="hl-4">=&gt;</span><span class="hl-1"> </span><span class="hl-2">a</span><span class="hl-1"> + </span><span class="hl-2">b</span><span class="hl-1">);</span><br/><br/><span class="hl-2">sum$</span><span class="hl-1">.</span><span class="hl-6">subscribe</span><span class="hl-1">((</span><span class="hl-2">sum</span><span class="hl-1">) </span><span class="hl-4">=&gt;</span><span class="hl-1"> </span><span class="hl-2">console</span><span class="hl-1">.</span><span class="hl-6">log</span><span class="hl-1">(</span><span class="hl-3">&#39;Sum&#39;</span><span class="hl-1">, </span><span class="hl-2">sum</span><span class="hl-1">));</span><br/><span class="hl-2">a$</span><span class="hl-1">.</span><span class="hl-6">set</span><span class="hl-1">(</span><span class="hl-7">2</span><span class="hl-1">);</span>
</code><button type="button">Copy</button></pre>

<p>output:</p>
<pre><code class="text">Sum 2
Sum 3
</code><button type="button">Copy</button></pre>

<a id="md:asynchronous-set" class="tsd-anchor"></a><h4 class="tsd-anchor-link">Asynchronous set<a href="#md:asynchronous-set" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h4><p>A <code>derived</code> can directly manipulate its value using the set method instead of relying on the returned value of the provided function.
This flexibility allows you to manage asynchronous operations or apply filtering logic before updating the observable's value.</p>
<pre><code class="typescript"><span class="hl-0">import</span><span class="hl-1"> {</span><span class="hl-2">writable</span><span class="hl-1">, </span><span class="hl-2">derived</span><span class="hl-1">} </span><span class="hl-0">from</span><span class="hl-1"> </span><span class="hl-3">&quot;@amadeus-it-group/tansu&quot;</span><span class="hl-1">;</span><br/><br/><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-5">a$</span><span class="hl-1"> = </span><span class="hl-6">writable</span><span class="hl-1">(</span><span class="hl-7">0</span><span class="hl-1">);</span><br/><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-5">asynchronousDouble$</span><span class="hl-1"> = </span><span class="hl-6">derived</span><span class="hl-1">(</span><span class="hl-2">a$</span><span class="hl-1">, (</span><span class="hl-2">a</span><span class="hl-1">, </span><span class="hl-2">set</span><span class="hl-1">) </span><span class="hl-4">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-5">plannedLater</span><span class="hl-1"> = </span><span class="hl-6">setTimeout</span><span class="hl-1">(() </span><span class="hl-4">=&gt;</span><span class="hl-1"> </span><span class="hl-6">set</span><span class="hl-1">(</span><span class="hl-2">a</span><span class="hl-1"> * </span><span class="hl-7">2</span><span class="hl-1">));</span><br/><span class="hl-1">  </span><span class="hl-0">return</span><span class="hl-1"> () </span><span class="hl-4">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-8">// This clean-up function is called if there is no listener anymore,</span><br/><span class="hl-1">    </span><span class="hl-8">// or if the value of a$ changed</span><br/><span class="hl-1">    </span><span class="hl-8">// In this case, the function passed to setTimeout should not be called</span><br/><span class="hl-1">    </span><span class="hl-8">// (if it was not called already)</span><br/><span class="hl-1">    </span><span class="hl-6">clearTimeout</span><span class="hl-1">(</span><span class="hl-2">plannedLater</span><span class="hl-1">);</span><br/><span class="hl-1">  };</span><br/><span class="hl-1">}, -</span><span class="hl-7">1</span><span class="hl-1">);</span><br/><br/><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-5">evenOnly$</span><span class="hl-1"> = </span><span class="hl-6">derived</span><span class="hl-1">(</span><span class="hl-2">a$</span><span class="hl-1">, (</span><span class="hl-2">a</span><span class="hl-1">, </span><span class="hl-2">set</span><span class="hl-1">) </span><span class="hl-4">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-0">if</span><span class="hl-1"> (</span><span class="hl-2">a</span><span class="hl-1"> % </span><span class="hl-7">2</span><span class="hl-1"> === </span><span class="hl-7">0</span><span class="hl-1">) {</span><br/><span class="hl-1">      </span><span class="hl-6">set</span><span class="hl-1">(</span><span class="hl-2">a</span><span class="hl-1">);</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">}, &lt;</span><span class="hl-9">number</span><span class="hl-1"> | </span><span class="hl-9">undefined</span><span class="hl-1">&gt;</span><span class="hl-4">undefined</span><span class="hl-1">);</span><br/><br/><span class="hl-2">asynchronousDouble$</span><span class="hl-1">.</span><span class="hl-6">subscribe</span><span class="hl-1">((</span><span class="hl-2">double</span><span class="hl-1">) </span><span class="hl-4">=&gt;</span><span class="hl-1"> </span><span class="hl-2">console</span><span class="hl-1">.</span><span class="hl-6">log</span><span class="hl-1">(</span><span class="hl-3">&#39;Double (asynchronous)&#39;</span><span class="hl-1">, </span><span class="hl-2">double</span><span class="hl-1">));</span><br/><span class="hl-2">evenOnly$</span><span class="hl-1">.</span><span class="hl-6">subscribe</span><span class="hl-1">((</span><span class="hl-2">value</span><span class="hl-1">) </span><span class="hl-4">=&gt;</span><span class="hl-1"> </span><span class="hl-2">console</span><span class="hl-1">.</span><span class="hl-6">log</span><span class="hl-1">(</span><span class="hl-3">&#39;Even&#39;</span><span class="hl-1">, </span><span class="hl-2">value</span><span class="hl-1">));</span><br/><br/><span class="hl-2">a$</span><span class="hl-1">.</span><span class="hl-6">set</span><span class="hl-1">(</span><span class="hl-7">1</span><span class="hl-1">);</span><br/><span class="hl-2">a$</span><span class="hl-1">.</span><span class="hl-6">set</span><span class="hl-1">(</span><span class="hl-7">2</span><span class="hl-1">);</span>
</code><button type="button">Copy</button></pre>

<p>output:</p>
<pre><code class="text">Double (asynchronous) -1
Even 0
Even 2
Double (asynchronous) 4
</code><button type="button">Copy</button></pre>

<a id="md:computed" class="tsd-anchor"></a><h3 class="tsd-anchor-link">computed<a href="#md:computed" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h3><p><a href="https://amadeusitgroup.github.io/tansu/functions/computed.html" target="_blank" class="external">api documentation</a></p>
<p>A <code>computed</code> store is another variant of a derived store, with the following characteristics:</p>
<ul>
<li>
<p><strong>Implicit Dependencies:</strong> Unlike in a derived store, there is no requirement to explicitly declare dependencies.</p>
</li>
<li>
<p><strong>Dynamic Dependency Listening:</strong> Dependencies are determined based on their usage. This implies that a dependency not actively used is not automatically &quot;listened&quot; to, optimizing resource utilization.</p>
</li>
</ul>
<a id="md:switch-map" class="tsd-anchor"></a><h4 class="tsd-anchor-link">Switch map<a href="#md:switch-map" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h4><p>This capability to subscribe/unsubscribe to the dependency allows to create switch maps in a natural way.</p>
<pre><code class="typescript"><span class="hl-0">import</span><span class="hl-1"> {</span><span class="hl-2">writable</span><span class="hl-1">, </span><span class="hl-2">computed</span><span class="hl-1">} </span><span class="hl-0">from</span><span class="hl-1"> </span><span class="hl-3">&quot;@amadeus-it-group/tansu&quot;</span><span class="hl-1">;</span><br/><br/><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-5">switchToA$</span><span class="hl-1"> = </span><span class="hl-6">writable</span><span class="hl-1">(</span><span class="hl-4">true</span><span class="hl-1">);</span><br/><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-5">a$</span><span class="hl-1"> = </span><span class="hl-6">writable</span><span class="hl-1">(</span><span class="hl-7">1</span><span class="hl-1">);</span><br/><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-5">b$</span><span class="hl-1"> = </span><span class="hl-6">writable</span><span class="hl-1">(</span><span class="hl-7">0</span><span class="hl-1">);</span><br/><br/><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-5">computedValue$</span><span class="hl-1"> = </span><span class="hl-6">computed</span><span class="hl-1">(() </span><span class="hl-4">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-0">if</span><span class="hl-1"> (</span><span class="hl-6">switchToA$</span><span class="hl-1">()) {</span><br/><span class="hl-1">    </span><span class="hl-2">console</span><span class="hl-1">.</span><span class="hl-6">log</span><span class="hl-1">(</span><span class="hl-3">&#39;Return a$&#39;</span><span class="hl-1">);</span><br/><span class="hl-1">    </span><span class="hl-0">return</span><span class="hl-1"> </span><span class="hl-6">a$</span><span class="hl-1">();</span><br/><span class="hl-1">  } </span><span class="hl-0">else</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-2">console</span><span class="hl-1">.</span><span class="hl-6">log</span><span class="hl-1">(</span><span class="hl-3">&#39;Return b$&#39;</span><span class="hl-1">);</span><br/><span class="hl-1">    </span><span class="hl-0">return</span><span class="hl-1"> </span><span class="hl-6">b$</span><span class="hl-1">();</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">});</span><br/><br/><span class="hl-2">computedValue$</span><span class="hl-1">.</span><span class="hl-6">subscribe</span><span class="hl-1">((</span><span class="hl-2">value</span><span class="hl-1">) </span><span class="hl-4">=&gt;</span><span class="hl-1"> </span><span class="hl-2">console</span><span class="hl-1">.</span><span class="hl-6">log</span><span class="hl-1">(</span><span class="hl-3">&#39;Computed value:&#39;</span><span class="hl-1">, </span><span class="hl-2">value</span><span class="hl-1">));</span><br/><span class="hl-2">a$</span><span class="hl-1">.</span><span class="hl-6">set</span><span class="hl-1">(</span><span class="hl-7">2</span><span class="hl-1">);</span><br/><span class="hl-2">switchToA$</span><span class="hl-1">.</span><span class="hl-6">set</span><span class="hl-1">(</span><span class="hl-4">false</span><span class="hl-1">);</span><br/><span class="hl-2">a$</span><span class="hl-1">.</span><span class="hl-6">set</span><span class="hl-1">(</span><span class="hl-7">3</span><span class="hl-1">);</span><br/><span class="hl-2">a$</span><span class="hl-1">.</span><span class="hl-6">set</span><span class="hl-1">(</span><span class="hl-7">4</span><span class="hl-1">);</span><br/><span class="hl-2">switchToA$</span><span class="hl-1">.</span><span class="hl-6">set</span><span class="hl-1">(</span><span class="hl-4">true</span><span class="hl-1">);</span><br/>
</code><button type="button">Copy</button></pre>

<p>output:</p>
<pre><code class="text">Return a$
Computed value: 1
Return a$
Computed value: 2
Return b$
Computed value: 0
Return a$
Computed value: 4
</code><button type="button">Copy</button></pre>

<p>When <code>switchToA$.set(false)</code> is called, the subscription to <code>a$</code> is canceled, which means that subsequent changes to <code>a$</code> will no longer trigger the calculation., which is only performed again when switchToA$ is set back to true.</p>
<a id="md:readable" class="tsd-anchor"></a><h3 class="tsd-anchor-link">readable<a href="#md:readable" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h3><p><a href="https://amadeusitgroup.github.io/tansu/functions/readable.html" target="_blank" class="external">api documentation</a></p>
<p>Similar to Svelte stores, this function generates a store where the value cannot be externally modified.</p>
<pre><code class="typescript"><span class="hl-0">import</span><span class="hl-1"> {</span><span class="hl-2">readable</span><span class="hl-1">} </span><span class="hl-0">from</span><span class="hl-1"> </span><span class="hl-3">&#39;@amadeus-it-group/tansu&#39;</span><span class="hl-1">;</span><br/><br/><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-5">time</span><span class="hl-1"> = </span><span class="hl-6">readable</span><span class="hl-1">(</span><span class="hl-4">new</span><span class="hl-1"> </span><span class="hl-6">Date</span><span class="hl-1">(), (</span><span class="hl-2">set</span><span class="hl-1">) </span><span class="hl-4">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-5">interval</span><span class="hl-1"> = </span><span class="hl-6">setInterval</span><span class="hl-1">(() </span><span class="hl-4">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-6">set</span><span class="hl-1">(</span><span class="hl-4">new</span><span class="hl-1"> </span><span class="hl-6">Date</span><span class="hl-1">());</span><br/><span class="hl-1">  }, </span><span class="hl-7">1000</span><span class="hl-1">);</span><br/><br/><span class="hl-1">  </span><span class="hl-0">return</span><span class="hl-1"> () </span><span class="hl-4">=&gt;</span><span class="hl-1"> </span><span class="hl-6">clearInterval</span><span class="hl-1">(</span><span class="hl-2">interval</span><span class="hl-1">);</span><br/><span class="hl-1">});</span>
</code><button type="button">Copy</button></pre>

<a id="md:derived-vs-computed" class="tsd-anchor"></a><h3 class="tsd-anchor-link">derived vs computed<a href="#md:derived-vs-computed" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h3><p>While derived and computed may appear similar, they exhibit distinct characteristics that can significantly impact effectiveness based on use-cases:</p>
<ul>
<li>
<p><strong>Declaration of Dependencies:</strong></p>
<ul>
<li><code>computed</code>: No explicit declaration of dependencies is required, providing more flexibility in code composition.</li>
<li><code>derived</code>: Requires explicit declaration of dependencies.</li>
</ul>
</li>
<li>
<p><strong>Performance:</strong></p>
<ul>
<li><code>computed</code>: Better performance by re-running the function only based on changes in the stores involved in the last run.</li>
<li><code>derived</code>: Re-run the function each time a dependent store changes.</li>
</ul>
</li>
<li>
<p><strong>Asynchronous State:</strong></p>
<ul>
<li><code>computed</code>: Unable to manage asynchronous state.</li>
<li><code>derived</code>: Can handle asynchronous state with the <code>set</code> method.</li>
</ul>
</li>
<li>
<p><strong>Skipping Value Emission:</strong></p>
<ul>
<li><code>computed</code>: Does not provide a mechanism to skip emitting values.</li>
<li><code>derived</code>: Allows skipping the emission of values by choosing not to call the provided <code>set</code> method.</li>
</ul>
</li>
<li>
<p><strong>Setup and Teardown:</strong></p>
<ul>
<li><code>computed</code>: Lacks explicit setup and teardown methods.</li>
<li><code>derived</code>: Supports setup and teardown methods, allowing actions such as adding or removing DOM listeners.</li>
<li>When the last listener unsubscribes and then subscribes again, the derived function is rerun due to its setup-teardown functionality. In contrast, a computed provides the last value without recomputing if dependencies haven't changed in the meantime.</li>
</ul>
</li>
</ul>
<p>While <code>computed</code> feels more intuitive in many use-cases, <code>derived</code> excels in scenarios where <code>computed</code> falls short, particularly in managing asynchronous state and providing more granular control over value emissions.</p>
<p>Carefully choosing between them based on specific requirements enhances the effectiveness of state management in your application.</p>
<a id="md:getting-the-value" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Getting the value<a href="#md:getting-the-value" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h3><p>There are three ways for getting the value of a store:</p>
<pre><code class="typescript"><span class="hl-0">import</span><span class="hl-1"> {</span><span class="hl-2">writable</span><span class="hl-1">, </span><span class="hl-2">get</span><span class="hl-1">} </span><span class="hl-0">from</span><span class="hl-1"> </span><span class="hl-3">&quot;@amadeus-it-group/tansu&quot;</span><span class="hl-1">;</span><br/><br/><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-5">count$</span><span class="hl-1"> = </span><span class="hl-6">writable</span><span class="hl-1">(</span><span class="hl-7">1</span><span class="hl-1">);</span><br/><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-5">unsubscribe</span><span class="hl-1"> = </span><span class="hl-2">count$</span><span class="hl-1">.</span><span class="hl-6">subscribe</span><span class="hl-1">((</span><span class="hl-2">count</span><span class="hl-1">) </span><span class="hl-4">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-8">// Will be called with the updated value synchronously first, then each time count$ changes.</span><br/><span class="hl-1">  </span><span class="hl-8">// `unsubscribe` must be called to prevent future calls.</span><br/><span class="hl-1">  </span><span class="hl-2">console</span><span class="hl-1">.</span><span class="hl-6">log</span><span class="hl-1">(</span><span class="hl-2">count</span><span class="hl-1">);</span><br/><span class="hl-1">});</span><br/><br/><span class="hl-8">// A store is also a function that you can call to get the instant value.</span><br/><span class="hl-2">console</span><span class="hl-1">.</span><span class="hl-6">log</span><span class="hl-1">(</span><span class="hl-6">count$</span><span class="hl-1">());</span><br/><br/><span class="hl-8">// Equivalent to</span><br/><span class="hl-2">console</span><span class="hl-1">.</span><span class="hl-6">log</span><span class="hl-1">(</span><span class="hl-6">get</span><span class="hl-1">(</span><span class="hl-2">count$</span><span class="hl-1">));</span>
</code><button type="button">Copy</button></pre>

<blockquote>
<p>[!NOTE]
Getting the instant value implies the subscription and unsubription on the store:</p>
<ul>
<li>It can be important to know in case of setup/teardown functions.</li>
<li>In the same scope, prefer to store the value once in a local variable instead of calling <code>store$()</code> several times.</li>
</ul>
<p>When called inside a reactive context (i.e. inside a computed), getting the value serves to know and &quot;listen&quot; the dependent stores.</p>
</blockquote>
<a id="md:batch" class="tsd-anchor"></a><h3 class="tsd-anchor-link">batch<a href="#md:batch" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h3><p><a href="https://amadeusitgroup.github.io/tansu/functions/batch.html" target="_blank" class="external">api documentation</a></p>
<p>Contrary to other libraries like Angular with signals or Svelte with runes, where the callback of a subscription is executed asynchronously (usually referenced as an &quot;effect&quot;), we have maintained the constraint of synchronicity between the store changes and their subscriptions in Tansu.</p>
<p>While it is acceptable for these frameworks to defer these calls since their goals are well-known in advance (to optimize their final rendering), this is not the case for Tansu, where the goal is to be adaptable to any situation.</p>
<p>The problem with synchronous subscriptions is that it can create &quot;glitches&quot;. Subscribers and computed store callbacks that are run too many times can create incorrect intermediate values.</p>
<p>Svelte stores resolved the <a href="https://github.com/sveltejs/svelte/pull/2955" target="_blank" class="external">diamond dependency issue</a>, but it does not match all the use-cases.</p>
<p>Let's have a look at the following example:</p>
<pre><code class="typescript"><span class="hl-0">import</span><span class="hl-1"> {</span><span class="hl-2">writable</span><span class="hl-1">, </span><span class="hl-2">derived</span><span class="hl-1">} </span><span class="hl-0">from</span><span class="hl-1"> </span><span class="hl-3">&#39;@amadeus-it-group/tansu&#39;</span><span class="hl-1">;</span><br/><br/><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-5">firstName</span><span class="hl-1"> = </span><span class="hl-6">writable</span><span class="hl-1">(</span><span class="hl-3">&#39;Arsène&#39;</span><span class="hl-1">);</span><br/><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-5">lastName</span><span class="hl-1"> = </span><span class="hl-6">writable</span><span class="hl-1">(</span><span class="hl-3">&#39;Lupin&#39;</span><span class="hl-1">);</span><br/><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-5">fullName</span><span class="hl-1"> = </span><span class="hl-6">derived</span><span class="hl-1">([</span><span class="hl-2">firstName</span><span class="hl-1">, </span><span class="hl-2">lastName</span><span class="hl-1">], ([</span><span class="hl-2">a</span><span class="hl-1">, </span><span class="hl-2">b</span><span class="hl-1">]) </span><span class="hl-4">=&gt;</span><span class="hl-1"> </span><span class="hl-3">`</span><span class="hl-4">${</span><span class="hl-2">a</span><span class="hl-4">}</span><span class="hl-3"> </span><span class="hl-4">${</span><span class="hl-2">b</span><span class="hl-4">}</span><span class="hl-3">`</span><span class="hl-1">);</span><br/><span class="hl-2">fullName</span><span class="hl-1">.</span><span class="hl-6">subscribe</span><span class="hl-1">((</span><span class="hl-2">name</span><span class="hl-1">) </span><span class="hl-4">=&gt;</span><span class="hl-1"> </span><span class="hl-2">console</span><span class="hl-1">.</span><span class="hl-6">log</span><span class="hl-1">(</span><span class="hl-2">name</span><span class="hl-1">)); </span><span class="hl-8">// logs any change to fullName</span><br/><span class="hl-2">firstName</span><span class="hl-1">.</span><span class="hl-6">set</span><span class="hl-1">(</span><span class="hl-3">&#39;Sherlock&#39;</span><span class="hl-1">);</span><br/><span class="hl-2">lastName</span><span class="hl-1">.</span><span class="hl-6">set</span><span class="hl-1">(</span><span class="hl-3">&#39;Holmes&#39;</span><span class="hl-1">);</span><br/><span class="hl-2">console</span><span class="hl-1">.</span><span class="hl-6">log</span><span class="hl-1">(</span><span class="hl-3">&#39;Process end&#39;</span><span class="hl-1">);</span>
</code><button type="button">Copy</button></pre>

<p>output:</p>
<pre><code class="text">Arsène Lupin
Sherlock Lupin
Sherlock Holmes
Process end
</code><button type="button">Copy</button></pre>

<p>The fullName store successively went through different states, including an inconsistent one, as <code>Sherlock Lupin</code> does not exist! Even if it can be seen as just an intermediate state, it is <strong>fundamental</strong> for a state management to only manage consistent data in order to prevent issues and optimize the code.</p>
<p>In Tansu, the <code>batch</code> is available to defer <strong>synchronously</strong> the subscribers calls, and de facto the dependent <code>derived</code> or <code>computed</code> calculation to solve all kind of multiple dependencies issues.</p>
<p>The previous example is resolved this way:</p>
<pre><code class="typescript"><span class="hl-0">import</span><span class="hl-1"> {</span><span class="hl-2">writable</span><span class="hl-1">, </span><span class="hl-2">derived</span><span class="hl-1">, </span><span class="hl-2">computed</span><span class="hl-1">, </span><span class="hl-2">batch</span><span class="hl-1">} </span><span class="hl-0">from</span><span class="hl-1"> </span><span class="hl-3">&#39;@amadeus-it-group/tansu&#39;</span><span class="hl-1">;</span><br/><br/><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-5">firstName</span><span class="hl-1"> = </span><span class="hl-6">writable</span><span class="hl-1">(</span><span class="hl-3">&#39;Arsène&#39;</span><span class="hl-1">);</span><br/><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-5">lastName</span><span class="hl-1"> = </span><span class="hl-6">writable</span><span class="hl-1">(</span><span class="hl-3">&#39;Lupin&#39;</span><span class="hl-1">);</span><br/><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-5">fullName</span><span class="hl-1"> = </span><span class="hl-6">derived</span><span class="hl-1">([</span><span class="hl-2">firstName</span><span class="hl-1">, </span><span class="hl-2">lastName</span><span class="hl-1">], ([</span><span class="hl-2">a</span><span class="hl-1">, </span><span class="hl-2">b</span><span class="hl-1">]) </span><span class="hl-4">=&gt;</span><span class="hl-1"> </span><span class="hl-3">`</span><span class="hl-4">${</span><span class="hl-2">a</span><span class="hl-4">}</span><span class="hl-3"> </span><span class="hl-4">${</span><span class="hl-2">b</span><span class="hl-4">}</span><span class="hl-3">`</span><span class="hl-1">);</span><br/><span class="hl-8">// note that the fullName store could alternatively be create with computed:</span><br/><span class="hl-8">// const fullName = computed(() =&gt; `${firstName()} ${lastName()}`);</span><br/><span class="hl-2">fullName</span><span class="hl-1">.</span><span class="hl-6">subscribe</span><span class="hl-1">((</span><span class="hl-2">name</span><span class="hl-1">) </span><span class="hl-4">=&gt;</span><span class="hl-1"> </span><span class="hl-2">console</span><span class="hl-1">.</span><span class="hl-6">log</span><span class="hl-1">(</span><span class="hl-2">name</span><span class="hl-1">)); </span><span class="hl-8">// logs any change to fullName</span><br/><span class="hl-6">batch</span><span class="hl-1">(() </span><span class="hl-4">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-2">firstName</span><span class="hl-1">.</span><span class="hl-6">set</span><span class="hl-1">(</span><span class="hl-3">&#39;Sherlock&#39;</span><span class="hl-1">);</span><br/><span class="hl-1">    </span><span class="hl-2">lastName</span><span class="hl-1">.</span><span class="hl-6">set</span><span class="hl-1">(</span><span class="hl-3">&#39;Holmes&#39;</span><span class="hl-1">);</span><br/><span class="hl-1">});</span><br/><span class="hl-2">console</span><span class="hl-1">.</span><span class="hl-6">log</span><span class="hl-1">(</span><span class="hl-3">&#39;Process end&#39;</span><span class="hl-1">);</span>
</code><button type="button">Copy</button></pre>

<p>output:</p>
<pre><code class="text">Arsène Lupin
Sherlock Holmes
Process end
</code><button type="button">Copy</button></pre>

<blockquote>
<p>[!NOTE]</p>
<ul>
<li>Retrieving the immediate value of a store (using any of the three methods mentioned earlier: calling <code>subscribe</code> with a subscriber that will be called with the value synchronously, using <code>get</code> or calling the store as a function) always provides the value based on the up-to-date values of all dependent stores (even if this requires re-computations of a computed or a derived inside the batch)</li>
<li>all calls to subscribers (excluding the first synchronous call during the subscribe process) are deferred until the end of the batch</li>
<li>if a subscriber has already been notified of a new value inside the batch (for example, when it is a new subscriber registered within the batch), it won't be notified again at the end of the batch if the value remains unchanged. Subscribers are invoked only when the store's value has changed since their last call.</li>
<li><code>batch</code> can be called inside <code>batch</code>. The subscriber calls are performed at the end of the first batch, synchronously.</li>
</ul>
</blockquote>
<a id="md:asreadable" class="tsd-anchor"></a><h3 class="tsd-anchor-link">asReadable<a href="#md:asreadable" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h3><p><a href="https://amadeusitgroup.github.io/tansu/functions/asReadable.html" target="_blank" class="external">api documentation</a></p>
<p><code>asReadable</code> returns a new store that exposes only the essential elements needed for subscribing to the store. It also includes any extra methods passed as parameters.</p>
<p>This is useful and widely used to compose a custom store:</p>
<ul>
<li>The first parameter is the writable store,</li>
<li>The second parameter is an object to extend the readable store returned.</li>
</ul>
<pre><code class="typescript"><span class="hl-0">import</span><span class="hl-1"> {</span><span class="hl-2">writable</span><span class="hl-1">, </span><span class="hl-2">asReadable</span><span class="hl-1">} </span><span class="hl-0">from</span><span class="hl-1"> </span><span class="hl-3">&quot;@amadeus-it-group/tansu&quot;</span><span class="hl-1">;</span><br/><br/><span class="hl-4">function</span><span class="hl-1"> </span><span class="hl-6">createCounter</span><span class="hl-1">(</span><span class="hl-2">initialValue</span><span class="hl-1">: </span><span class="hl-9">number</span><span class="hl-1">) {</span><br/><span class="hl-1">  </span><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-5">store$</span><span class="hl-1"> = </span><span class="hl-6">writable</span><span class="hl-1">(</span><span class="hl-2">initialValue</span><span class="hl-1">);</span><br/><br/><span class="hl-1">  </span><span class="hl-0">return</span><span class="hl-1"> </span><span class="hl-6">asReadable</span><span class="hl-1">(</span><span class="hl-2">store$</span><span class="hl-1">, {</span><br/><span class="hl-1">    </span><span class="hl-6">increment</span><span class="hl-2">:</span><span class="hl-1"> () </span><span class="hl-4">=&gt;</span><span class="hl-1"> </span><span class="hl-2">store$</span><span class="hl-1">.</span><span class="hl-6">update</span><span class="hl-1">((</span><span class="hl-2">value</span><span class="hl-1">) </span><span class="hl-4">=&gt;</span><span class="hl-1"> </span><span class="hl-2">value</span><span class="hl-1"> + </span><span class="hl-7">1</span><span class="hl-1">),</span><br/><span class="hl-1">    </span><span class="hl-6">decrement</span><span class="hl-2">:</span><span class="hl-1"> () </span><span class="hl-4">=&gt;</span><span class="hl-1"> </span><span class="hl-2">store$</span><span class="hl-1">.</span><span class="hl-6">update</span><span class="hl-1">((</span><span class="hl-2">value</span><span class="hl-1">) </span><span class="hl-4">=&gt;</span><span class="hl-1"> </span><span class="hl-2">value</span><span class="hl-1"> - </span><span class="hl-7">1</span><span class="hl-1">),</span><br/><span class="hl-1">    </span><span class="hl-6">reset</span><span class="hl-2">:</span><span class="hl-1"> () </span><span class="hl-4">=&gt;</span><span class="hl-1"> </span><span class="hl-2">store$</span><span class="hl-1">.</span><span class="hl-6">set</span><span class="hl-1">(</span><span class="hl-2">initialValue</span><span class="hl-1">)</span><br/><span class="hl-1">  });</span><br/><span class="hl-1">}</span><br/><br/><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-5">counter$</span><span class="hl-1"> = </span><span class="hl-6">createCounter</span><span class="hl-1">(</span><span class="hl-7">0</span><span class="hl-1">);</span><br/><br/><span class="hl-2">counter$</span><span class="hl-1">.</span><span class="hl-6">subscribe</span><span class="hl-1">((</span><span class="hl-2">value</span><span class="hl-1">) </span><span class="hl-4">=&gt;</span><span class="hl-1"> </span><span class="hl-2">console</span><span class="hl-1">.</span><span class="hl-6">log</span><span class="hl-1">(</span><span class="hl-3">&#39;Value: &#39;</span><span class="hl-1">, </span><span class="hl-2">value</span><span class="hl-1">));</span><br/><br/><span class="hl-2">counter$</span><span class="hl-1">.</span><span class="hl-6">increment</span><span class="hl-1">();</span><br/><span class="hl-2">counter$</span><span class="hl-1">.</span><span class="hl-6">reset</span><span class="hl-1">();</span><br/><span class="hl-2">counter$</span><span class="hl-1">.</span><span class="hl-6">set</span><span class="hl-1">(</span><span class="hl-7">2</span><span class="hl-1">); </span><span class="hl-8">// Error, set does not exist</span>
</code><button type="button">Copy</button></pre>

<p>output:</p>
<pre><code class="text">Value: 0
Value: 1
Value: 0
(Error thrown !)
</code><button type="button">Copy</button></pre>

<a id="md:aswritable" class="tsd-anchor"></a><h3 class="tsd-anchor-link">asWritable<a href="#md:aswritable" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h3><p><a href="https://amadeusitgroup.github.io/tansu/functions/asWritable.html" target="_blank" class="external">api documentation</a></p>
<p><code>asWritable</code> is almost the same as an <code>asReadable</code>, with the key difference being its implementation of the <a href="https://amadeusitgroup.github.io/tansu/interfaces/WritableSignal.html" target="_blank" class="external">WritableSignal</a> interface.</p>
<p>It's useful when you want to connect your computed store to the original one, or implement a custom <code>set</code> method. The <code>set</code> method can be passed directly in the second parameter or within an object, similar to the usage in <code>asReadable</code>.</p>
<p>For example:</p>
<pre><code class="typescript"><span class="hl-0">import</span><span class="hl-1"> {</span><span class="hl-2">writable</span><span class="hl-1">, </span><span class="hl-2">asWritable</span><span class="hl-1">} </span><span class="hl-0">from</span><span class="hl-1"> </span><span class="hl-3">&quot;@amadeus-it-group/tansu&quot;</span><span class="hl-1">;</span><br/><br/><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-5">number$</span><span class="hl-1"> = </span><span class="hl-6">writable</span><span class="hl-1">(</span><span class="hl-7">1</span><span class="hl-1">);</span><br/><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-5">double$</span><span class="hl-1"> = </span><span class="hl-6">computed</span><span class="hl-1">(() </span><span class="hl-4">=&gt;</span><span class="hl-1"> </span><span class="hl-6">number$</span><span class="hl-1">() * </span><span class="hl-7">2</span><span class="hl-1">);</span><br/><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-5">writableDouble$</span><span class="hl-1"> = </span><span class="hl-6">asWritable</span><span class="hl-1">(</span><span class="hl-2">double$</span><span class="hl-1">, (</span><span class="hl-2">doubleNumber</span><span class="hl-1">) </span><span class="hl-4">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-2">number$</span><span class="hl-1">.</span><span class="hl-6">set</span><span class="hl-1">(</span><span class="hl-2">doubleNumber</span><span class="hl-1"> / </span><span class="hl-7">2</span><span class="hl-1">);</span><br/><span class="hl-1">});</span><br/><span class="hl-8">/* equivalent to:</span><br/><span class="hl-8">  const writableDouble$ = asWritable(double$, {</span><br/><span class="hl-8">    set: (doubleNumber) =&gt; number$.set(doubleNumber / 2)</span><br/><span class="hl-8">  });</span><br/><span class="hl-8">*/</span><br/><br/><span class="hl-2">writableDouble$</span><span class="hl-1">.</span><span class="hl-6">subscribe</span><span class="hl-1">((</span><span class="hl-2">value</span><span class="hl-1">) </span><span class="hl-4">=&gt;</span><span class="hl-1"> </span><span class="hl-2">console</span><span class="hl-1">.</span><span class="hl-6">log</span><span class="hl-1">(</span><span class="hl-3">&#39;Value: &#39;</span><span class="hl-1">, </span><span class="hl-2">value</span><span class="hl-1">));</span><br/><br/><span class="hl-2">writableDouble$</span><span class="hl-1">.</span><span class="hl-6">set</span><span class="hl-1">(</span><span class="hl-7">2</span><span class="hl-1">); </span><span class="hl-8">// Nothing is triggered here, as number$ is already set with 1</span><br/><span class="hl-2">writableDouble$</span><span class="hl-1">.</span><span class="hl-6">set</span><span class="hl-1">(</span><span class="hl-7">4</span><span class="hl-1">);</span><br/>
</code><button type="button">Copy</button></pre>

<p>output:</p>
<pre><code class="text">Value: 2
Value: 4
</code><button type="button">Copy</button></pre>

<a id="md:integration-in-frameworks" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Integration in frameworks<a href="#md:integration-in-frameworks" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h2><a id="md:tansu-works-well-with-the-svelte-framework" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Tansu works well with the Svelte framework<a href="#md:tansu-works-well-with-the-svelte-framework" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h3><p>Tansu is designed to be and to remain fully compatible with Svelte.</p>
<a id="md:tansu-works-well-with-the-angular-ecosystem" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Tansu works well with the Angular ecosystem<a href="#md:tansu-works-well-with-the-angular-ecosystem" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h3><p>Here is an example of an Angular component using a Tansu store:</p>
<pre><code class="typescript"><span class="hl-0">import</span><span class="hl-1"> { </span><span class="hl-2">Component</span><span class="hl-1"> } </span><span class="hl-0">from</span><span class="hl-1"> </span><span class="hl-3">&quot;@angular/core&quot;</span><span class="hl-1">;</span><br/><span class="hl-0">import</span><span class="hl-1"> { </span><span class="hl-2">AsyncPipe</span><span class="hl-1"> } </span><span class="hl-0">from</span><span class="hl-1"> </span><span class="hl-3">&#39;@angular/common&#39;</span><span class="hl-1">;</span><br/><span class="hl-0">import</span><span class="hl-1"> { </span><span class="hl-2">Store</span><span class="hl-1">, </span><span class="hl-2">computed</span><span class="hl-1">, </span><span class="hl-2">get</span><span class="hl-1"> } </span><span class="hl-0">from</span><span class="hl-1"> </span><span class="hl-3">&quot;@amadeus-it-group/tansu&quot;</span><span class="hl-1">;</span><br/><br/><span class="hl-8">// A store is a class extending Store from Tansu</span><br/><span class="hl-4">class</span><span class="hl-1"> </span><span class="hl-9">CounterStore</span><span class="hl-1"> </span><span class="hl-4">extends</span><span class="hl-1"> </span><span class="hl-9">Store</span><span class="hl-1">&lt;</span><span class="hl-9">number</span><span class="hl-1">&gt; {</span><br/><span class="hl-1">  </span><span class="hl-4">constructor</span><span class="hl-1">() {</span><br/><span class="hl-1">    </span><span class="hl-4">super</span><span class="hl-1">(</span><span class="hl-7">0</span><span class="hl-1">); </span><span class="hl-8">// initialize store&#39;s value (state)</span><br/><span class="hl-1">  }</span><br/><br/><span class="hl-1">  </span><span class="hl-8">// implement state manipulation logic as regular methods</span><br/><span class="hl-1">  </span><span class="hl-6">increment</span><span class="hl-1">() {</span><br/><span class="hl-1">    </span><span class="hl-8">// create new state based on the current state</span><br/><span class="hl-1">    </span><span class="hl-4">this</span><span class="hl-1">.</span><span class="hl-6">update</span><span class="hl-1">(</span><span class="hl-2">value</span><span class="hl-1"> </span><span class="hl-4">=&gt;</span><span class="hl-1"> </span><span class="hl-2">value</span><span class="hl-1"> + </span><span class="hl-7">1</span><span class="hl-1">);</span><br/><span class="hl-1">  }</span><br/><br/><span class="hl-1">  </span><span class="hl-6">reset</span><span class="hl-1">() {</span><br/><span class="hl-1">    </span><span class="hl-8">// replace the entire state with a new value</span><br/><span class="hl-1">    </span><span class="hl-4">this</span><span class="hl-1">.</span><span class="hl-6">set</span><span class="hl-1">(</span><span class="hl-7">0</span><span class="hl-1">);</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">}</span><br/><br/><span class="hl-1">@</span><span class="hl-6">Component</span><span class="hl-1">({</span><br/><span class="hl-1">  </span><span class="hl-2">selector:</span><span class="hl-1"> </span><span class="hl-3">&quot;my-app&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-2">template:</span><span class="hl-1"> </span><span class="hl-3">`</span><br/><span class="hl-3">    &lt;button (click)=&quot;counter$.increment()&quot;&gt;+&lt;/button&gt; &lt;br /&gt;</span><br/><br/><span class="hl-3">    &lt;!-- store values can be displayed in a template with the standard async pipe --&gt;</span><br/><span class="hl-3">    Counter: {{ counter$ | async }} &lt;br /&gt;</span><br/><span class="hl-3">    Double counter: {{ doubleCounter$ | async }} &lt;br /&gt;</span><br/><span class="hl-3">  `</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-2">standalone:</span><span class="hl-1"> </span><span class="hl-4">true</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-2">imports:</span><span class="hl-1"> [</span><span class="hl-2">AsyncPipe</span><span class="hl-1">]</span><br/><span class="hl-1">})</span><br/><span class="hl-0">export</span><span class="hl-1"> </span><span class="hl-4">class</span><span class="hl-1"> </span><span class="hl-9">App</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-8">//  A store can be instantiated directly or registered in the DI container</span><br/><span class="hl-1">  </span><span class="hl-2">counter$</span><span class="hl-1"> = </span><span class="hl-4">new</span><span class="hl-1"> </span><span class="hl-6">CounterStore</span><span class="hl-1">();</span><br/><br/><span class="hl-1">  </span><span class="hl-8">// One can easily create computed values by specifying a transformation function</span><br/><span class="hl-1">  </span><span class="hl-2">doubleCounter$</span><span class="hl-1"> = </span><span class="hl-6">computed</span><span class="hl-1">(() </span><span class="hl-4">=&gt;</span><span class="hl-1"> </span><span class="hl-7">2</span><span class="hl-1"> * </span><span class="hl-6">get</span><span class="hl-1">(</span><span class="hl-4">this</span><span class="hl-1">.</span><span class="hl-2">counter$</span><span class="hl-1">));</span><br/><span class="hl-1">}</span>
</code><button type="button">Copy</button></pre>

<p>While being fairly minimal, this example demonstrates most of the Tansu APIs with Angular.</p>
<ul>
<li>works with the standard <code>async</code> pipe out of the box</li>
<li>stores can be registered in the dependency injection (DI) container at any level (module or component injector)</li>
<li>stores can be used easily with rxjs because they implement the <code>InteropObservable</code> interface</li>
<li>conversely, rxjs observables (or any object implementing the <code>InteropObservable</code> interface) can easily be used with Tansu (e.g. in Tansu <code>computed</code> or <code>derived</code>).</li>
</ul>
<a id="md:contributing-to-the-project" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Contributing to the project<a href="#md:contributing-to-the-project" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h2><p>Please check the <a href="media/DEVELOPER.md">DEVELOPER.md</a> for documentation on building and testing the project on your local development machine.</p>
<a id="md:credits-and-the-prior-art" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Credits and the prior art<a href="#md:credits-and-the-prior-art" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h2><ul>
<li><a href="https://github.com/sveltejs/rfcs/blob/master/text/0002-reactive-stores.md" target="_blank" class="external">Svelte</a> gets all the credit for the initial idea and the API design.</li>
<li><a href="https://hackmd.io/zLKrFIadTMS2T6zCYGyHew?view" target="_blank" class="external">NgRx component stores</a> solve a similar problem with a different approach.</li>
</ul>
</div></div><div class="col-sidebar"><div class="page-menu"><div class="tsd-navigation settings"><details class="tsd-accordion"><summary class="tsd-accordion-summary"><h3><svg width="20" height="20" viewBox="0 0 24 24" fill="none"><use href="assets/icons.svg#icon-chevronDown"></use></svg>Settings</h3></summary><div class="tsd-accordion-details"><div class="tsd-theme-toggle"><label class="settings-label" for="tsd-theme">Theme</label><select id="tsd-theme"><option value="os">OS</option><option value="light">Light</option><option value="dark">Dark</option></select></div></div></details></div><details open class="tsd-accordion tsd-page-navigation"><summary class="tsd-accordion-summary"><h3><svg width="20" height="20" viewBox="0 0 24 24" fill="none"><use href="assets/icons.svg#icon-chevronDown"></use></svg>On This Page</h3></summary><div class="tsd-accordion-details"><a href="#md:tansu"><span>Tansu</span></a><ul><li><a href="#md:installation"><span>Installation</span></a></li><li><a href="#md:usage"><span>Usage</span></a></li><li><ul><li><a href="#md:writable"><span>writable</span></a></li><li><ul><li><a href="#md:basic-usage"><span>Basic usage</span></a></li><li><a href="#md:setup-and-teardown"><span>Setup and teardown</span></a></li></ul></li><li><a href="#md:derived"><span>derived</span></a></li><li><ul><li><a href="#md:single-store"><span>Single store</span></a></li><li><a href="#md:multiple-stores"><span>Multiple stores</span></a></li><li><a href="#md:asynchronous-set"><span>Asynchronous set</span></a></li></ul></li><li><a href="#md:computed"><span>computed</span></a></li><li><ul><li><a href="#md:switch-map"><span>Switch map</span></a></li></ul></li><li><a href="#md:readable"><span>readable</span></a></li><li><a href="#md:derived-vs-computed"><span>derived vs computed</span></a></li><li><a href="#md:getting-the-value"><span>Getting the value</span></a></li><li><a href="#md:batch"><span>batch</span></a></li><li><a href="#md:asreadable"><span>as<wbr/>Readable</span></a></li><li><a href="#md:aswritable"><span>as<wbr/>Writable</span></a></li></ul></li><li><a href="#md:integration-in-frameworks"><span>Integration in frameworks</span></a></li><li><ul><li><a href="#md:tansu-works-well-with-the-svelte-framework"><span>Tansu works well with the <wbr/>Svelte framework</span></a></li><li><a href="#md:tansu-works-well-with-the-angular-ecosystem"><span>Tansu works well with the <wbr/>Angular ecosystem</span></a></li></ul></li><li><a href="#md:contributing-to-the-project"><span>Contributing to the project</span></a></li><li><a href="#md:credits-and-the-prior-art"><span>Credits and the prior art</span></a></li></ul></div></details></div><div class="site-menu"><nav class="tsd-navigation"><a href="modules.html" class="current"><svg class="tsd-kind-icon" viewBox="0 0 24 24"><use href="assets/icons.svg#icon-1"></use></svg><span>@amadeus-it-group/tansu</span></a><ul class="tsd-small-nested-navigation" id="tsd-nav-container" data-base="."><li>Loading...</li></ul></nav></div></div></div><footer><p class="tsd-generator">Generated using <a href="https://typedoc.org/" target="_blank">TypeDoc</a></p></footer><div class="overlay"></div></body></html>
